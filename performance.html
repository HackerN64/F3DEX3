<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.11.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>F3DEX3: Performance Results</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript" src="darkmode_toggle.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-extra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">F3DEX3
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.11.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('performance.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Performance Results</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md37"></a>
Performance Results</h1>
<p>F3DEX3_NOC matches or beats the RSP performance of F3DEX2 on <b>all</b> critical paths in the microcode, including command dispatch, vertex processing, and triangle processing. Then, the RDP and memory traffic performance improvements of F3DEX3&ndash;56 vertex buffer, auto-batched rendering, etc.&ndash;should further improve overall game performance from there.</p>
<h2><a class="anchor" id="autotoc_md38"></a>
Cycle Counts</h2>
<p>These are cycle counts for many key paths in the microcode. Lower numbers are better. The timings are hand-counted taking into account all pipeline stalls and all dual-issue conditions. Instruction alignment after branches is usually taken into account, but in some cases it is assumed to be optimal.</p>
<p>All numbers assume default profiling configuration. <a class="el" href="structTri.html">Tri</a> numbers assume texture, shade, and Z, and not flushing the buffer. <a class="el" href="structTri.html">Tri</a> numbers are measured from the first cycle of the command handler inclusive, to the first cycle of whatever is after $ra exclusive; this is in order to capture an extra stall cycle in F3DEX2 when finishing a triangle and going to the next command.</p>
<p>Vertex numbers assume no extra F3DEX3 features (packed normals, ambient occlusion, etc.). These features are listed below as the number of extra cycles the feature costs per vertex pair. ltbasic is the codepath when point lighting, specular, and Fresnel are disabled; ltadv is the codepath with any of these enabled. The reason timings are listed separately for each number of lights is because some implementations are pipelined for two lights, so going from an even to an odd number of lights adds a different time than vice versa.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone">F3DEX2   </th><th class="markdownTableHeadNone">F3DEX3_NOC   </th><th class="markdownTableHeadNone">F3DEX3    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Command dispatch   </td><td class="markdownTableBodyNone">12   </td><td class="markdownTableBodyNone">12   </td><td class="markdownTableBodyNone">12    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Small RDP command   </td><td class="markdownTableBodyNone">14   </td><td class="markdownTableBodyNone">5   </td><td class="markdownTableBodyNone">5    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Only/2nd tri to offscreen   </td><td class="markdownTableBodyNone">27   </td><td class="markdownTableBodyNone">25   </td><td class="markdownTableBodyNone">25    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">1st tri to offscreen   </td><td class="markdownTableBodyNone">28   </td><td class="markdownTableBodyNone">26   </td><td class="markdownTableBodyNone">26    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Only/2nd tri to clip   </td><td class="markdownTableBodyNone">32   </td><td class="markdownTableBodyNone">30   </td><td class="markdownTableBodyNone">30    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">1st tri to clip   </td><td class="markdownTableBodyNone">33   </td><td class="markdownTableBodyNone">31   </td><td class="markdownTableBodyNone">31    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Only/2nd tri to backface   </td><td class="markdownTableBodyNone">38   </td><td class="markdownTableBodyNone">36   </td><td class="markdownTableBodyNone">36    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">1st tri to backface   </td><td class="markdownTableBodyNone">39   </td><td class="markdownTableBodyNone">37   </td><td class="markdownTableBodyNone">37    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Only/2nd tri to degenerate   </td><td class="markdownTableBodyNone">42   </td><td class="markdownTableBodyNone">38   </td><td class="markdownTableBodyNone">38    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">1st tri to degenerate   </td><td class="markdownTableBodyNone">43   </td><td class="markdownTableBodyNone">39   </td><td class="markdownTableBodyNone">39    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Only/2nd tri to occluded   </td><td class="markdownTableBodyNone">Can't   </td><td class="markdownTableBodyNone">Can't   </td><td class="markdownTableBodyNone">42    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">1st tri to occluded   </td><td class="markdownTableBodyNone">Can't   </td><td class="markdownTableBodyNone">Can't   </td><td class="markdownTableBodyNone">43    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Only/2nd tri to draw   </td><td class="markdownTableBodyNone">172   </td><td class="markdownTableBodyNone">156   </td><td class="markdownTableBodyNone">158    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">1st tri to draw   </td><td class="markdownTableBodyNone">173   </td><td class="markdownTableBodyNone">157   </td><td class="markdownTableBodyNone">159    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="structTri.html">Tri</a> snake   </td><td class="markdownTableBodyNone">Can't   </td><td class="markdownTableBodyNone">*   </td><td class="markdownTableBodyNone">*    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="unionVtx.html">Vtx</a> before DMA start   </td><td class="markdownTableBodyNone">16   </td><td class="markdownTableBodyNone">17   </td><td class="markdownTableBodyNone">17    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="unionVtx.html">Vtx</a> pair, no lighting   </td><td class="markdownTableBodyNone">54   </td><td class="markdownTableBodyNone">54   </td><td class="markdownTableBodyNone">70    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="unionVtx.html">Vtx</a> pair, 0 dir lts   </td><td class="markdownTableBodyNone">Can't   </td><td class="markdownTableBodyNone">65   </td><td class="markdownTableBodyNone">81    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="unionVtx.html">Vtx</a> pair, 1 dir lt   </td><td class="markdownTableBodyNone">73   </td><td class="markdownTableBodyNone">70   </td><td class="markdownTableBodyNone">86    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="unionVtx.html">Vtx</a> pair, 2 dir lts   </td><td class="markdownTableBodyNone">76   </td><td class="markdownTableBodyNone">77   </td><td class="markdownTableBodyNone">93    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="unionVtx.html">Vtx</a> pair, 3 dir lts   </td><td class="markdownTableBodyNone">88   </td><td class="markdownTableBodyNone">84   </td><td class="markdownTableBodyNone">100    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="unionVtx.html">Vtx</a> pair, 4 dir lts   </td><td class="markdownTableBodyNone">91   </td><td class="markdownTableBodyNone">91   </td><td class="markdownTableBodyNone">107    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="unionVtx.html">Vtx</a> pair, 5 dir lts   </td><td class="markdownTableBodyNone">103   </td><td class="markdownTableBodyNone">98   </td><td class="markdownTableBodyNone">114    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="unionVtx.html">Vtx</a> pair, 6 dir lts   </td><td class="markdownTableBodyNone">106   </td><td class="markdownTableBodyNone">105   </td><td class="markdownTableBodyNone">121    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="unionVtx.html">Vtx</a> pair, 7 dir lts   </td><td class="markdownTableBodyNone">118   </td><td class="markdownTableBodyNone">112   </td><td class="markdownTableBodyNone">128    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="unionVtx.html">Vtx</a> pair, 8 dir lts   </td><td class="markdownTableBodyNone">Can't   </td><td class="markdownTableBodyNone">119   </td><td class="markdownTableBodyNone">135    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="unionVtx.html">Vtx</a> pair, 9 dir lts   </td><td class="markdownTableBodyNone">Can't   </td><td class="markdownTableBodyNone">126   </td><td class="markdownTableBodyNone">142    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="unionVtx.html">Vtx</a> pair, 0 point lts   </td><td class="markdownTableBodyNone">Can't   </td><td class="markdownTableBodyNone">117   </td><td class="markdownTableBodyNone">133    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="unionVtx.html">Vtx</a> pair, 1 point lt   </td><td class="markdownTableBodyNone">276   </td><td class="markdownTableBodyNone">194   </td><td class="markdownTableBodyNone">210    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="unionVtx.html">Vtx</a> pair, 2 point lts   </td><td class="markdownTableBodyNone">420   </td><td class="markdownTableBodyNone">271   </td><td class="markdownTableBodyNone">287    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="unionVtx.html">Vtx</a> pair, 3 point lts   </td><td class="markdownTableBodyNone">564   </td><td class="markdownTableBodyNone">348   </td><td class="markdownTableBodyNone">364    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="unionVtx.html">Vtx</a> pair, 4 point lts   </td><td class="markdownTableBodyNone">708   </td><td class="markdownTableBodyNone">425   </td><td class="markdownTableBodyNone">441    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="unionVtx.html">Vtx</a> pair, 5 point lts   </td><td class="markdownTableBodyNone">852   </td><td class="markdownTableBodyNone">502   </td><td class="markdownTableBodyNone">518    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="unionVtx.html">Vtx</a> pair, 6 point lts   </td><td class="markdownTableBodyNone">996   </td><td class="markdownTableBodyNone">579   </td><td class="markdownTableBodyNone">595    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="unionVtx.html">Vtx</a> pair, 7 point lts   </td><td class="markdownTableBodyNone">1140   </td><td class="markdownTableBodyNone">656   </td><td class="markdownTableBodyNone">672    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="unionVtx.html">Vtx</a> pair, 8 point lts   </td><td class="markdownTableBodyNone">Can't   </td><td class="markdownTableBodyNone">733   </td><td class="markdownTableBodyNone">749    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="unionVtx.html">Vtx</a> pair, 9 point lts   </td><td class="markdownTableBodyNone">Can't   </td><td class="markdownTableBodyNone">810   </td><td class="markdownTableBodyNone">826    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Packed normals, ltbasic   </td><td class="markdownTableBodyNone">Can't   </td><td class="markdownTableBodyNone">6   </td><td class="markdownTableBodyNone">6    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Light-to-alpha, ltbasic   </td><td class="markdownTableBodyNone">Can't   </td><td class="markdownTableBodyNone">10   </td><td class="markdownTableBodyNone">10    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Ambient occlusion, ltbasic   </td><td class="markdownTableBodyNone">Can't   </td><td class="markdownTableBodyNone">9   </td><td class="markdownTableBodyNone">9    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Packed normals, ltadv   </td><td class="markdownTableBodyNone">Can't   </td><td class="markdownTableBodyNone">-3   </td><td class="markdownTableBodyNone">-3    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Light-to-alpha, ltadv   </td><td class="markdownTableBodyNone">Can't   </td><td class="markdownTableBodyNone">6   </td><td class="markdownTableBodyNone">6    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Ambient occlusion, ltadv   </td><td class="markdownTableBodyNone">Can't   </td><td class="markdownTableBodyNone">0   </td><td class="markdownTableBodyNone">0    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Specular or fresnel   </td><td class="markdownTableBodyNone">Can't   </td><td class="markdownTableBodyNone">47   </td><td class="markdownTableBodyNone">47    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">+ Fresnel   </td><td class="markdownTableBodyNone">Can't   </td><td class="markdownTableBodyNone">23   </td><td class="markdownTableBodyNone">23    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">+ Specular per dir lt   </td><td class="markdownTableBodyNone">Can't   </td><td class="markdownTableBodyNone">13   </td><td class="markdownTableBodyNone">13    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">+ Specular per point lt   </td><td class="markdownTableBodyNone">Can't   </td><td class="markdownTableBodyNone">13   </td><td class="markdownTableBodyNone">13    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Light dir xfrm, 0 dir lts   </td><td class="markdownTableBodyNone">Can't   </td><td class="markdownTableBodyNone">92   </td><td class="markdownTableBodyNone">92    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Light dir xfrm, 1 dir lt   </td><td class="markdownTableBodyNone">141   </td><td class="markdownTableBodyNone">92   </td><td class="markdownTableBodyNone">92    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Light dir xfrm, 2 dir lts   </td><td class="markdownTableBodyNone">180   </td><td class="markdownTableBodyNone">93   </td><td class="markdownTableBodyNone">93    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Light dir xfrm, 3 dir lts   </td><td class="markdownTableBodyNone">219   </td><td class="markdownTableBodyNone">118   </td><td class="markdownTableBodyNone">118    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Light dir xfrm, 4 dir lts   </td><td class="markdownTableBodyNone">258   </td><td class="markdownTableBodyNone">119   </td><td class="markdownTableBodyNone">119    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Light dir xfrm, 5 dir lts   </td><td class="markdownTableBodyNone">297   </td><td class="markdownTableBodyNone">144   </td><td class="markdownTableBodyNone">144    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Light dir xfrm, 6 dir lts   </td><td class="markdownTableBodyNone">336   </td><td class="markdownTableBodyNone">145   </td><td class="markdownTableBodyNone">145    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Light dir xfrm, 7 dir lts   </td><td class="markdownTableBodyNone">375   </td><td class="markdownTableBodyNone">170   </td><td class="markdownTableBodyNone">170    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Light dir xfrm, 8 dir lts   </td><td class="markdownTableBodyNone">Can't   </td><td class="markdownTableBodyNone">171   </td><td class="markdownTableBodyNone">171    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Light dir xfrm, 9 dir lts   </td><td class="markdownTableBodyNone">Can't   </td><td class="markdownTableBodyNone">196   </td><td class="markdownTableBodyNone">196   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md39"></a>
Triangle Snake Cycle Counts</h2>
<h3><a class="anchor" id="autotoc_md40"></a>
Very Long Snakes</h3>
<p>For this section, we assume almost all tris are contained in very long snakes, so the overhead of starting and ending snakes is negligible. This overhead is discussed in the next section.</p>
<p>We are assuming that the same set of tris is being drawn with or without snakes. Thus, cycles from <code>tri_main_from_snake</code> through the instruction after the return exclusive are not counted here, as they are the same regardless of which method is being used.</p>
<p>For a pair of tris drawn without snakes, i.e. with a single <code>SP2Triangles</code> command, the cycles are:</p><ul>
<li>Command dispatch: 12</li>
<li>First tri up to <code>tri_main_from_snake</code>: 5</li>
<li>Second tri up to <code>tri_main_from_snake</code>: 4</li>
<li>Total: 21</li>
</ul>
<p>For a pair of tris which are part of a long snake, the cycles are:</p><ul>
<li>Each tri up to <code>tri_main_from_snake</code>: 11</li>
<li>Total: 22</li>
</ul>
<p>However, there's also the memory bandwidth savings. The <code>SP2Triangles</code> command is 8 bytes and the two tris in a long snake are 2 bytes, so switching to snake saves 6 bytes of bandwidth. Testing has shown that RSP DMAs on average transfer about 2.2 bytes per cycle, though it depends on the length. So this is a savings of about 2.7 cycles of RDRAM / RDP time. Since the DMAs loading this data are input buffer loads, and the RSP stalls waiting for input buffer loads (it does not do useful work during this time), this is also 2.7 cycles of RSP time. This offsets the 1 extra cycle of processing the tri pair above.</p>
<p>Therefore, switching to snake (assuming very long snakes) saves about 2.7 cycles of RDRAM / RDP time and 1.7 cycles of RSP time per two tris, or about 0.9 RSP cycles and 1.4 RDRAM cycles per tri.</p>
<h3><a class="anchor" id="autotoc_md41"></a>
Starting a Snake</h3>
<p>Since a <code>SPTriSnake</code> command encodes 5 triangles, for comparison to <code>SP2Triangles</code> we will consider the overhead for 10 triangles total / two snake starts.</p>
<p>For <code>SPTriSnake</code>, this is 2 x (12 cycles command dispatch + 4 cycles snake initialization + 5 tris x 11 cycles per tri as discussed above) = 142 RSP cycles. And it is 16 bytes of loads = 7.3 cycles of RDRAM / RDP time and stall RSP time. So the total cost is 149.3 RSP and 7.3 RDRAM cycles.</p>
<p>For <code>SP2Triangles</code>, this is 5 x (21 cycles as discussed above) = 105 RSP cycles. And it is 40 bytes of loads = 18.2 cycles of RDRAM / RDP time and stall RSP time. So the total cost is 123.2 RSP and 18.2 RDRAM cycles.</p>
<p>But drawing those 10 tris as part of very long snakes would have saved 13.5 RDRAM cycles and 8.5 RSP cycles. So the relative cost of drawing these tris as two start-of-snakes instead of in very long snakes is 34.6 RSP cycles and 2.6 RDRAM cycles. Thus the cost of each start-of-snake relative to long snakes is 17.3 RSP cycles and 1.3 RDRAM cycles.</p>
<h3><a class="anchor" id="autotoc_md42"></a>
Ending a Snake</h3>
<p>Ending a snake costs 12 cycles of RSP time and has no direct impact on memory traffic. However, calculating the overall performance is more complicated: the snake can end after 1-8 bytes of the <code>SPContinueSnake</code> command, and the remaining bytes are "wasted" in that they do not contribute to drawing tris with memory bandwidth savings.</p>
<p>From a mesh optimization standpoint, this is not an issue. If you have a snake which has filled 8 bytes of the previous <code>SPContinueSnake</code> command, and you have another triangle to draw, there are only two cases. If that tri can't be appended to the snake, you have to draw it with a <code>SP1Triangle</code> command either way, so there is no performance difference. If it can be appended to the snake, doing so will take 8 bytes of memory traffic&ndash;the same as the <code>SP1Triangle</code> command. The snake end penalty will have to be paid whether before or after this tri. And it's 11 RSP cycles to draw one more tri in an existing snake, whereas the command dispatch plus second tri code for <code>SP1Triangle</code> is 16 cycles. So it's better to continue a snake than to stop it early and use non-snake commands, even if this leads to a mostly empty <code>SPContinueSnake</code> command. Of course, if you can fill up even more tris in the command, the performance benefit increases.</p>
<p>Assuming snake lengths are uniformly distributed, on average a snake will end after 4.5 bytes (the same number of triangles) of a <code>SPContinueSnake</code> command. In this case, the command will take 4.5 tris x 11 cycles per tri + 12 cycle end snake penalty = 61.5 RSP cycles, and 8 bytes of memory traffic = 3.6 RDRAM cycles. If these 4.5 tris were instead drawn with <code>SP2Triangles</code> commands, that would be 2.25 commands = 47.3 RSP cycles and 18 bytes = 8.2 RDRAM cycles. Thus on average, the snake end costs 14.2 RSP cycles and saves 4.6 RDRAM cycles compared to <code>SP2Triangles</code> commands. But drawing those 4.5 tris as part of very long snakes would have saved 3.9 RSP cycles and 6.1 RDRAM cycles. So the average cost of ending a snake relative to very long snakes is 18.1 RSP and 1.5 RDRAM cycles.</p>
<h3><a class="anchor" id="autotoc_md43"></a>
Example</h3>
<p>Suppose there are 4000 tris on screen. Suppose that 90% of them have been encoded with snakes&ndash;the rest are disconnected single tris or tri pairs (quads). That 10% are then encoded with <code>SP2Triangles</code> commands, which is the same performance with or without snakes, so we ignore those tris, and there are 3600 "snakeable" tris in the scene.</p>
<p>Suppose that the average snake length is 16, to account for some objects with more contiguous tris with the same material, and others with smaller disjoint parts. Thus, for 3600 tris, there are 225 snakes.</p>
<p>Switching the 3600 tris from <code>SP2Triangles</code> commands to long snakes saves 4860 RDRAM cycles and 3060 RSP cycles. However, the 225 snake starts and ends cost 630 RDRAM and 7965 RSP cycles relative to this. So the total performance change of switching to snakes in this case is that the RDRAM / RDP goes faster by 4230 cycles = 68 us, but the RSP goes slower by 4905 cycles = 78 us. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="md_docs_2documentation.html">Documentation</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.11.0 </li>
  </ul>
</div>
</body>
</html>
